version: '2'

services:
    #php
    php:
        build: "./docker-php/7.0${STAGING_ENV}"
        container_name: "php-${PROJECT_UID}"
        working_dir: "${PATHBASE}"
        restart: "always"
        environment:
          USER_UID: "${USER_UID}"
          USER_GID: "${USER_GID}"
          XDEBUG_CONFIG: "${XDEBUG_CONFIG}"
          PHP_IDE_CONFIG: "${PHP_IDE_CONFIG}"
        volumes:
            - "${PATH_PROJECTS}:/var/www"
            # ssh git auth
            - "$SSH_AUTH_SOCK:/ssh-agent"
            - "~/.ssh/id_rsa:/home/www-data/private_key"
            # bitbucket auth
            - "${HOME_PATH}/.ssh:/home/www-data/.ssh"
            - "${HOME_PATH}/.composer:/home/www-data/.composer"
        networks:
            - "default"

    #nginx
    nginx:
        build: "./docker-nginx/symfony-1.11"
        container_name: "nginx-${PROJECT_UID}"
        working_dir: "${PATHBASE}"
        restart: "always"
        ports:
            - "${HTTP_PORT}:80"
        volumes:
            - "${PATH_PROJECTS}:/var/www"
            - "${PATHBASE}:/var/www/medzoner"
        environment:
          NGINX_HOST: "${NGINX_HOST}"
          NGINX_PATH: "${NGINX_PATH}"
          MYSQL_USERNAME: "${MYSQL_USER}"
          MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
        networks:
            - "default"

##networks (better than links)
networks:
    default:
        driver: "bridge"

volumes:
    db: {}
